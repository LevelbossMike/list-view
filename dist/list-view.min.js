// ==========================================================================
// Project:   Ember ListView
// Copyright: Â©2012-2013 Erik Bryn, Yapp Inc., and contributors.
// License:   Licensed under MIT license
// ==========================================================================


// Last commit: 1827d39 (2014-01-13 13:01:51 +0100)


!function(){function e(e,t){return e&&t&&e.x===t.x&&e.y===t.y}function t(){var t,i,r;Ember.instrument("view.updateContext.positionElement",this,function(){t=n(this,"element"),i=n(this,"position"),r=this._position,i&&t&&(e(i,r)||(this._parentView.applyTransform(t,i.x,i.y),this._position=i))},this)}var n=Ember.get;Ember.set,Ember.ListItemViewMixin=Ember.Mixin.create({init:function(){this._super(),this.one("didInsertElement",t)},classNames:["ember-list-item-view"],_position:null,_positionDidChange:Ember.observer(t,"position"),_positionElement:t})}(),function(){function e(e){e.willInsertElement&&e.willInsertElement()}function t(e){e.didInsertElement&&e.didInsertElement()}function n(){var n,o,l,h;n=i(this,"element"),n&&(l=i(this,"context"),this.triggerRecursively("willClearRender"),this.lengthAfterRender>this.lengthBeforeRender&&(this.clearRenderedChildren(),this._childViews.length=this.lengthBeforeRender),l?(o=Ember.RenderBuffer(),o=this.renderToBuffer(o),h=this._childViews.length>0,h&&this.invokeRecursively(e,!1),n.innerHTML=o.innerString?o.innerString():s(o),r(this,"element",n),this.transitionTo("inDOM"),h&&this.invokeRecursively(t,!1)):n.innerHTML="")}var i=Ember.get,r=Ember.set,s=function(e){var t=[],n=e.childBuffers;return Ember.ArrayPolyfills.forEach.call(n,function(e){var n="string"==typeof e;n?t.push(e):e.array(t)}),t.join("")};Ember.ListItemView=Ember.View.extend(Ember.ListItemViewMixin,{updateContext:function(e){var t=i(this,"context");Ember.instrument("view.updateContext.render",this,function(){t!==e&&(this.set("context",e),e instanceof Ember.ObjectController&&this.set("controller",e))},this)},rerender:function(){Ember.run.scheduleOnce("render",this,n)},_contextDidChange:Ember.observer(n,"context","controller")})}(),function(){var e=Ember.get,t=Ember.set;Ember.ReusableListItemView=Ember.View.extend(Ember.ListItemViewMixin,{init:function(){this._super(),this.set("context",Ember.ObjectProxy.create())},isVisible:Ember.computed("context.content",function(){return!!this.get("context.content")}),updateContext:function(n){var i=e(this,"context.content");i!==n&&("inDOM"===this.state&&this.prepareForReuse(n),t(this,"context.content",n))},prepareForReuse:Ember.K})}(),function(){function e(e){if(e in n)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),r=0;r<i.length;r++){var s=i[r]+t;if(s in n)return s}return null}var t=document.createElement("div"),n=t.style,i=["Webkit","Moz","O","ms"],r=e("transform"),s=e("perspective"),o=null!==r,l=null!==s;Ember.ListViewHelper={transformProp:r,applyTransform:function(){return o?function(e,t,n){e.style[r]="translate("+t+"px, "+n+"px)"}:function(e,t,n){e.style.top=n+"px",e.style.left=t+"px"}}(),apply3DTransform:function(){return l?function(e,t,n){e.style[r]="translate3d("+t+"px, "+n+"px, 0)"}:o?function(e,t,n){e.style[r]="translate("+t+"px, "+n+"px)"}:function(e,t,n){e.style.top=n+"px",e.style.left=t+"px"}}()}}(),function(){function e(){var e=o(this,"content");e&&e.addArrayObserver(this)}function t(e){this.removeObject(e),e.destroy()}function n(){Ember.run.once(this,"_syncChildViews")}function i(e,t){return o(e,"contentIndex")-o(t,"contentIndex")}function r(){Ember.View.notifyMutationListeners&&Ember.run.once(Ember.View,"notifyMutationListeners")}function s(){var e,t,n,i;e=o(this,"elementWidth"),t=o(this,"columnCount"),n=e*t,i=this.$(".ember-list-container"),n&&i&&i.css("width",n)}var o=Ember.get,l=Ember.set,h=Math.min,c=Math.max,a=Math.floor,u=Math.ceil,d=Ember.ArrayPolyfills.forEach,m=Ember.create(Ember.ContainerView.proto().domManager);m.prepend=function(e,t){e.$(".ember-list-container").prepend(t),r()},Ember.ListViewMixin=Ember.Mixin.create({itemViewClass:Ember.ListItemView,emptyViewClass:Ember.View,classNames:["ember-list-view"],attributeBindings:["style"],domManager:m,scrollTop:0,bottomPadding:0,_lastEndingIndex:0,paddingCount:1,init:function(){this._super(),this.on("didInsertElement",s),this.columnCountDidChange(),this._syncChildViews(),this._addContentArrayObserver()},_addContentArrayObserver:Ember.beforeObserver(function(){e.call(this)},"content"),render:function(e){e.push('<div class="ember-list-container">'),this._super(e),e.push("</div>")},willInsertElement:function(){if(!this.get("height")||!this.get("rowHeight"))throw new Error("A ListView must be created with a height and a rowHeight.");this._super()},style:Ember.computed("height","width",function(){var e,t,n,i;e=o(this,"height"),t=o(this,"width"),i=o(this,"css"),n="",e&&(n+="height:"+e+"px;"),t&&(n+="width:"+t+"px;");for(var r in i)i.hasOwnProperty(r)&&(n+=r+":"+i[r]+";");return n}),scrollTo:function(){throw new Error("must override to perform the visual scroll and effectively delegate to _scrollContentTo")},_scrollTo:Ember.K,_scrollContentTo:function(e){var t,n,i,r,s,a;a=c(0,e),o(this,"scrollTop")!==a&&(a=Math.min(a,o(this,"totalHeight")-o(this,"height")),Ember.instrument("view._scrollContentTo",{scrollTop:a,content:o(this,"content"),startingIndex:this._startingIndex(),endingIndex:h(c(o(this,"content.length")-1,0),this._startingIndex()+this._numChildViewsForViewport())},function(){s=o(this,"content.length"),l(this,"scrollTop",a),r=c(s-1,0),t=this._startingIndex(),i=t+this._numChildViewsForViewport(),n=h(r,i),this.trigger("scrollYChanged",e),(t!==this._lastStartingIndex||n!==this._lastEndingIndex)&&(this._reuseChildren(),this._lastStartingIndex=t,this._lastEndingIndex=n)},this))},totalHeight:Ember.computed("content.length","rowHeight","columnCount","bottomPadding",function(){var e,t,n,i;return e=o(this,"content.length"),t=o(this,"rowHeight"),n=o(this,"columnCount"),i=o(this,"bottomPadding"),u(e/n)*t+i}),_prepareChildForReuse:function(e){e.prepareForReuse()},_reuseChildForContentIndex:function(e,t){var n,i,r,s;n=o(this,"content"),s=o(this,"enableProfiling"),r=this.positionForIndex(t),l(e,"position",r),l(e,"contentIndex",t),s&&Ember.instrument("view._reuseChildForContentIndex",r,function(){},this),i=n.objectAt(t),e.updateContext(i)},positionForIndex:function(e){var t,n,i,r,s,l;return t=o(this,"elementWidth")||1,n=o(this,"width")||1,i=o(this,"columnCount"),r=o(this,"rowHeight"),s=r*a(e/i),l=e%i*t,{y:s,x:l}},_childViewCount:function(){var e,t;return e=o(this,"content.length"),t=this._numChildViewsForViewport(),h(e,t)},columnCount:Ember.computed("width","elementWidth",function(){var e,t,n;return e=o(this,"elementWidth"),t=o(this,"width"),n=e?a(t/e):1}),columnCountDidChange:Ember.observer(function(){var e,t,n,i,r,c,a,u;c=this._lastColumnCount,t=o(this,"scrollTop"),a=o(this,"columnCount"),i=o(this,"maxScrollTop"),u=o(this,"element"),this._lastColumnCount=a,c&&(e=c/a,n=t*e,r=h(i,n),this._scrollTo(r),l(this,"scrollTop",r)),arguments.length>0&&Ember.run.schedule("afterRender",this,s)},"columnCount"),maxScrollTop:Ember.computed("height","totalHeight",function(){var e,t;return e=o(this,"totalHeight"),t=o(this,"height"),c(0,e-t)}),_numChildViewsForViewport:function(){var e,t,n,i;return e=o(this,"height"),t=o(this,"rowHeight"),n=o(this,"paddingCount"),i=o(this,"columnCount"),u(e/t)*i+n*i},_startingIndex:function(){var e,t,n,i,r,s;return r=o(this,"content.length"),e=o(this,"scrollTop"),t=o(this,"rowHeight"),n=o(this,"columnCount"),i=a(e/t)*n,s=c(r-1,0),h(i,s)},contentWillChange:Ember.beforeObserver(function(){var e;e=o(this,"content"),e&&e.removeArrayObserver(this)},"content"),contentDidChange:Ember.observer(function(){e.call(this),n.call(this)},"content"),needsSyncChildViews:Ember.observer(n,"height","width","columnCount"),_addItemView:function(){var e,t;e=o(this,"itemViewClass"),t=this.createChildView(e),this.pushObject(t)},_syncChildViews:function(){var e,n,i,r,s,l,h,c,a;if(!o(this,"isDestroyed")&&!o(this,"isDestroying")){if(n=this._childViewCount(),l=this.positionOrderedChildViews(),e=this._startingIndex(),i=e+n,s=n,r=l.length,c=s-r,0===c);else if(c>0)for(a=this._lastEndingIndex,h=0;c>h;h++,a++)this._addItemView(a);else d.call(l.splice(s,r),t,this);this._reuseChildren(),this._lastStartingIndex=e,this._lastEndingIndex=this._lastEndingIndex+c}},_reuseChildren:function(){var e,t,n,i,r,s,l,a,u,d,m;for(m=o(this,"scrollTop"),e=o(this,"content.length"),u=c(e-1,0),t=this.getReusableChildViews(),n=t.length,i=this._startingIndex(),a=i+this._numChildViewsForViewport(),r=h(u,a),d=h(a,i+n),l=i;d>l;l++)s=t[l%n],this._reuseChildForContentIndex(s,l)},getReusableChildViews:function(){return this._childViews},positionOrderedChildViews:function(){return this.getReusableChildViews().sort(i)},arrayWillChange:Ember.K,arrayDidChange:function(e,t){var i,r;"inDOM"===this.state&&((t>=this._lastStartingIndex||t<this._lastEndingIndex)&&(i=0,d.call(this.positionOrderedChildViews(),function(e){r=this._lastStartingIndex+i,this._reuseChildForContentIndex(e,r),i++},this)),n.call(this))}})}(),function(){var e=Ember.get;Ember.set,Ember.ListView=Ember.ContainerView.extend(Ember.ListViewMixin,{css:{position:"relative",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"},applyTransform:Ember.ListViewHelper.applyTransform,_scrollTo:function(t){var n=e(this,"element");n&&(n.scrollTop=t)},didInsertElement:function(){var t,n;t=this,n=e(this,"element"),this._updateScrollableHeight(),this._scroll=function(e){t.scroll(e)},Ember.$(n).on("scroll",this._scroll)},willDestroyElement:function(){var t;t=e(this,"element"),Ember.$(t).off("scroll",this._scroll)},scroll:function(e){Ember.run(this,this.scrollTo,e.target.scrollTop)},scrollTo:function(t){e(this,"element"),this._scrollTo(t),this._scrollContentTo(t)},totalHeightDidChange:Ember.observer(function(){Ember.run.scheduleOnce("afterRender",this,this._updateScrollableHeight)},"totalHeight"),_updateScrollableHeight:function(){"inDOM"===this.state&&this.$(".ember-list-container").css({height:e(this,"totalHeight")})}})}(),function(){function e(e){this.mouseWheel(e),e.preventDefault()}function t(e,t){e.addEventListener(u,t.start,!1),e.addEventListener("mousewheel",t.wheel,!1)}function n(e,t){e.removeEventListener(u,t.start,!1),e.removeEventListener("mousewheel",t.wheel,!1)}function i(e){window.addEventListener(d,e.move,!0),window.addEventListener(m,e.end,!0),window.addEventListener(f,e.cancel,!0)}function r(e){window.removeEventListener(d,e.move,!0),window.removeEventListener(m,e.end,!0),window.removeEventListener(f,e.cancel,!0)}function s(e,t){return function(n){t.call(e,n)}}function o(e){var t,n=e.changedTouches[0],i=n.target;return i&&g.test(i.tagName)?(t=document.createEvent("MouseEvents"),t.initMouseEvent("click",!0,!0,e.view,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),i.dispatchEvent(t)):void 0}var l,h,c,a,u,d,m,f,g=/input|textarea|select/i,p="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;p?(u="touchstart",l=function(e){var t=e.touches[0],n=t&&t.target;n&&g.test(n.tagName)||(i(this.scrollerEventHandlers),this.willBeginScroll(e.touches,e.timeStamp),e.preventDefault())},d="touchmove",h=function(e){this.continueScroll(e.touches,e.timeStamp)},m="touchend",c=function(e){this._isScrolling||o(e),r(this.scrollerEventHandlers),this.endScroll(e.timeStamp)},f="touchcancel",a=function(e){r(this.scrollerEventHandlers),this.endScroll(e.timeStamp)}):(u="mousedown",l=function(e){if(1===e.which){var t=e.target;t&&g.test(t.tagName)||(i(this.scrollerEventHandlers),this.willBeginScroll([e],e.timeStamp),e.preventDefault())}},d="mousemove",h=function(e){this.continueScroll([e],e.timeStamp)},m="mouseup",c=function(e){r(this.scrollerEventHandlers),this.endScroll(e.timeStamp)},f="mouseout",a=function(e){e.relatedTarget||(r(this.scrollerEventHandlers),this.endScroll(e.timeStamp))}),Ember.VirtualListScrollerEvents=Ember.Mixin.create({init:function(){return this.on("didInsertElement",this,"bindScrollerEvents"),this.on("willDestroyElement",this,"unbindScrollerEvents"),this.scrollerEventHandlers={start:s(this,l),move:s(this,h),end:s(this,c),cancel:s(this,a),wheel:s(this,e)},this._super()},bindScrollerEvents:function(){var e=this.get("element"),n=this.scrollerEventHandlers;t(e,n)},unbindScrollerEvents:function(){var e=this.get("element"),t=this.scrollerEventHandlers;n(e,t),r(t)}})}(),function(){function e(e){var n,i,r;e=e||this,n=t(e,"width"),i=t(e,"height"),r=t(e,"totalHeight"),e.scroller.setDimensions(n,i,n,r),e.trigger("scrollerDimensionsDidChange")}var t=(Math.max,Ember.get);Ember.set,Ember.VirtualListView=Ember.ContainerView.extend(Ember.ListViewMixin,Ember.VirtualListScrollerEvents,{_isScrolling:!1,_mouseWheel:null,css:{position:"relative",overflow:"hidden"},init:function(){this._super(),this.setupScroller(),this.setupPullToRefresh()},_scrollerTop:0,applyTransform:Ember.ListViewHelper.apply3DTransform,setupScroller:function(){var t;t=this,t.scroller=new Scroller(function(e,n){"inDOM"===t.state&&t.listContainerElement&&(t.applyTransform(t.listContainerElement,0,-n),t._scrollerTop=n,t._scrollContentTo(n))},{scrollingX:!1,scrollingComplete:function(){t.trigger("scrollingDidComplete")}}),t.trigger("didInitializeScroller"),e(t)},setupPullToRefresh:function(){this.pullToRefreshViewClass&&(this._insertPullToRefreshView(),this._activateScrollerPullToRefresh())},_insertPullToRefreshView:function(){this.pullToRefreshView=this.createChildView(this.pullToRefreshViewClass),this.insertAt(0,this.pullToRefreshView);var e=this;this.pullToRefreshView.on("didInsertElement",function(){e.applyTransform(this.get("element"),0,-1*e.pullToRefreshViewHeight)})},_activateScrollerPullToRefresh:function(){function e(){i.pullToRefreshView.set("active",!0),i.trigger("activatePullToRefresh")}function t(){i.pullToRefreshView.set("active",!1),i.trigger("deactivatePullToRefresh")}function n(){function e(){!i||i.get("isDestroyed")||i.get("isDestroying")||(i.scroller.finishPullToRefresh(),i.pullToRefreshView.set("refreshing",!1))}i.pullToRefreshView.set("refreshing",!0),i.startRefresh(e)}var i=this;this.scroller.activatePullToRefresh(this.pullToRefreshViewHeight,e,t,n)},getReusableChildViews:function(){var e=this._childViews[0];return e&&e===this.pullToRefreshView?this._childViews.slice(1):this._childViews},scrollerDimensionsNeedToChange:Ember.observer(function(){Ember.run.once(this,e)},"width","height","totalHeight"),didInsertElement:function(){this.listContainerElement=this.$("> .ember-list-container")[0]},willBeginScroll:function(e,t){this._isScrolling=!1,this.trigger("scrollingDidStart"),this.scroller.doTouchStart(e,t)},continueScroll:function(e,t){var n,i,r;this._isScrolling?this.scroller.doTouchMove(e,t):(n=this._scrollerTop,this.scroller.doTouchMove(e,t),i=this._scrollerTop,n!==i&&(r=Ember.$.Event("scrollerstart"),Ember.$(e[0].target).trigger(r),this._isScrolling=!0))},endScroll:function(e){this.scroller.doTouchEnd(e)},scrollTo:function(e,t){void 0===t&&(t=!0),this.scroller.scrollTo(0,e,t,1)},mouseWheel:function(e){var t,n,i;return t=e.webkitDirectionInvertedFromDevice,n=e.wheelDeltaY*(t?.8:-.8),i=this.scroller.__scrollTop+n,i>=0&&i<=this.scroller.__maxScrollTop&&this.scroller.scrollBy(0,n,!0),!1}})}(),function(){var e=Ember.get,t=(Ember.set,Math.min),n=Math.max,i=Math.floor;Math.ceil,Ember.ArrayPolyfills.forEach,Ember.ExpandableListView=Ember.ListView.extend({expandedIndices:Ember.arrayComputed("content.@each.expanded",{addedItem:function(e,t,n){return t.get("expanded")&&e.pushObject(Ember.Object.create({index:n.index})),e},removedItem:function(e,t,n){if(!t.get("expanded")){var i=e.findBy("index",n.index);e.removeObject(i)}return e}}),_startingIndex:function(){var r,s,o,l,h,c;h=e(this,"content.length"),r=e(this,"scrollTop"),s=e(this,"rowHeight"),o=e(this,"columnCount"),l=i(r/s)*o;var a=this.get("expandedIndices").filter(function(e){return e.index<l}).reduce(function(e,t){return e+t.get("expandedHeight")},0),u=i((r-a)/s)*o;return c=n(h-1,0),t(u,c)},positionForIndex:function(t){var n,r,s,o,l,h;n=e(this,"elementWidth")||1,r=e(this,"width")||1,s=e(this,"columnCount"),o=e(this,"rowHeight");var c=this.get("expandedIndices").filter(function(e){return e.get("index")<t}).reduce(function(e,t){return e+t.get("expandedHeight")},0);return l=o*i(t/s)+c,h=t%s*n,{y:l,x:h}},_reuseChildren:function(){var r,s,o,l,h,c,a,u,d,m,f;f=e(this,"scrollTop"),r=e(this,"content.length"),d=n(r-1,0),s=this.getReusableChildViews(),o=s.length,l=this._startingIndex(),u=l+this._numChildViewsForViewport();var g=this.get("expandedIndices").filter(function(e){var t=e.get("index");return t>=l&&u>=t}).reduce(function(e,t){return e+t.get("expandedHeight")},0),p=this.get("rowHeight"),w=i(g/p);for(h=t(d,u-w),m=t(u,l+o),a=l;m>a;a++)c=s[a%o],this._reuseChildForContentIndex(c,a)}})}(),function(){Ember.ExpandableListItemView=Ember.ListItemView.extend({setupExpandListener:function(){this.get("controller").on("changeExpand",this,this.logHeightAfterRender)}.on("didInsertElement"),removeExpandListener:function(){this.get("controller").off("changeExpand")}.on("willDestroyElement"),updateContext:function(e){null!=this.get("context")&&this.get("context").off("changeExpand"),this._super(e),null!=e&&e.on("changeExpand",this,this.logHeightAfterRender)},logHeightAfterRender:function(){Ember.run.scheduleOnce("afterRender",this,"logHeight")},logHeight:function(){var e=this._parentView.get("expandedIndices"),t=e.findBy("index",this.get("contentIndex")),n=this._parentView.rowHeight;null!=t&&t.set("expandedHeight",this.$().height()-n),this._parentView._syncChildViews()}})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");